# Deployment Checklist for Railway & Vercel

After the code cleanup, here's what you need to configure on your deployments:

## üöÇ Railway (Backend) Configuration

### Required Environment Variables

Go to your Railway project ‚Üí **Variables** tab and set:

1. **`OPENAI_API_KEY`** ‚ö†Ô∏è **CRITICAL - UPDATE THIS**
   - Set to your **new** OpenAI API key (the one that works)
   - This is required for LLM parsing step
   - Value: `sk-proj-...` (your new key)

2. **`CLARIFAI_PAT`**
   - Your Clarifai Personal Access Token
   - Required for OCR extraction step
   - Get it from: https://clarifai.com/settings/security

3. **`DATABASE_URL`**
   - Your PostgreSQL connection string
   - Format: `postgresql://user:password@host:port/database`
   - Railway should auto-generate this if you added a PostgreSQL service

4. **`CORS_ORIGINS`** (Optional - has default)
   - Comma-separated list of allowed origins
   - Default: `http://localhost:3000,http://localhost:3001,https://*.vercel.app`
   - Add your specific Vercel domain if needed: `https://your-project.vercel.app`

### Optional Environment Variables

5. **`OPENAI_MODEL`** (Optional)
   - Default: `gpt-3.5-turbo`
   - Can be changed to: `gpt-4o-mini`, `gpt-4o`, etc.

6. **Storage (S3-compatible)** - Only if using cloud storage
   - `STORAGE_ENDPOINT_URL`
   - `STORAGE_ACCESS_KEY_ID`
   - `STORAGE_SECRET_ACCESS_KEY`
   - `STORAGE_BUCKET_NAME`
   - `STORAGE_REGION`
   - If not set, files will be stored locally (may not persist on Railway)

### Railway Deployment Steps

1. **Verify Auto-Deploy**
   - Railway should auto-deploy when you push to GitHub
   - Check: Railway project ‚Üí **Settings** ‚Üí **Source**
   - Ensure it's connected to your GitHub repo and `main` branch

2. **Check Deployment Logs**
   - After push, check Railway ‚Üí **Deployments** tab
   - Look for any errors during build/deploy

3. **Get Your Railway URL**
   - Railway ‚Üí **Settings** ‚Üí **Networking**
   - Copy your public domain (e.g., `https://your-app.up.railway.app`)
   - You'll need this for Vercel configuration

---

## ‚ñ≤ Vercel (Frontend) Configuration

### Required Environment Variables

Go to your Vercel project ‚Üí **Settings** ‚Üí **Environment Variables**:

1. **`NEXT_PUBLIC_API_URL`** ‚ö†Ô∏è **CRITICAL - UPDATE THIS**
   - Set to your Railway backend URL
   - Format: `https://your-app.up.railway.app`
   - **Important**: No trailing slash!
   - Apply to: **Production**, **Preview**, and **Development**

### Vercel Deployment Steps

1. **Verify Auto-Deploy**
   - Vercel should auto-deploy when you push to GitHub
   - Check: Vercel project ‚Üí **Settings** ‚Üí **Git**
   - Ensure it's connected to your GitHub repo

2. **Check Build Settings**
   - **Root Directory**: `frontend`
   - **Framework Preset**: Next.js (auto-detected)
   - **Build Command**: `npm run build` (auto-detected)
   - **Output Directory**: `.next` (auto-detected)

3. **Redeploy After Environment Variable Changes**
   - After adding/updating `NEXT_PUBLIC_API_URL`, trigger a new deployment
   - Go to **Deployments** tab ‚Üí Click **"Redeploy"** on latest deployment
   - Or push a new commit to trigger auto-deploy

---

## ‚úÖ Verification Checklist

After configuring both platforms:

### Backend (Railway)
- [ ] `OPENAI_API_KEY` is set with your **new** working key
- [ ] `CLARIFAI_PAT` is set
- [ ] `DATABASE_URL` is set (auto-generated by Railway if using PostgreSQL service)
- [ ] Railway deployment is successful (check logs)
- [ ] Backend health check works: `https://your-app.up.railway.app/health`
- [ ] Backend root works: `https://your-app.up.railway.app/`

### Frontend (Vercel)
- [ ] `NEXT_PUBLIC_API_URL` is set to your Railway backend URL
- [ ] Vercel deployment is successful (check build logs)
- [ ] Frontend loads at: `https://your-project.vercel.app`
- [ ] No console errors in browser
- [ ] API calls are going to the correct backend URL

### Integration Test
- [ ] Upload an invoice from the frontend
- [ ] Check that it appears in the invoice list
- [ ] Verify OCR extraction is working (check backend logs)
- [ ] Verify LLM parsing is working (check backend logs)

---

## üîß Troubleshooting

### Backend Issues

**"insufficient_quota" error:**
- Check that `OPENAI_API_KEY` is set to your **new** working key
- Verify the key has quota available in OpenAI dashboard

**OCR extraction fails:**
- Check that `CLARIFAI_PAT` is set correctly
- Verify Clarifai PAT is valid at https://clarifai.com/settings/security

**CORS errors:**
- Verify `CORS_ORIGINS` includes your Vercel domain
- Check Railway logs for CORS-related errors
- The code already includes `https://*.vercel.app` by default

### Frontend Issues

**API calls fail:**
- Verify `NEXT_PUBLIC_API_URL` is set correctly (no trailing slash)
- Check browser console for errors
- Verify backend is accessible at the URL
- Check CORS settings on backend

**Build fails:**
- Check Vercel build logs
- Verify all dependencies are in `package.json`
- Ensure Node.js version is compatible

---

## üìù Quick Reference

### Railway Environment Variables
```bash
OPENAI_API_KEY=sk-proj-...your-new-key...
CLARIFAI_PAT=your-clarifai-pat
DATABASE_URL=postgresql://... (auto-generated)
CORS_ORIGINS=http://localhost:3000,http://localhost:3001,https://*.vercel.app
```

### Vercel Environment Variables
```bash
NEXT_PUBLIC_API_URL=https://your-app.up.railway.app
```

---

## üöÄ After Deployment

1. Test the full flow:
   - Upload an invoice (PDF or image)
   - Verify OCR extraction works
   - Verify LLM parsing extracts structured data
   - Check invoice appears in the list

2. Monitor logs:
   - Railway: Check deployment logs for backend errors
   - Vercel: Check function logs for frontend errors

3. Set up monitoring (optional):
   - Add error tracking (Sentry, etc.)
   - Set up uptime monitoring
   - Configure alerts for failures

